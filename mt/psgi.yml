version: "3"
services:
  httpd:
    volumes:
      - "./cgi-bin-mt.htaccess:/var/www/cgi-bin/mt/.htaccess"
  psgi:
    working_dir: /var/www/cgi-bin/mt
    command:
      - "starman"
      - "-E"
      - "production"
      - "--workers=2"
      - "--pid=/tmp/mt.psgi.pid"
      - "/var/www/cgi-bin/mt/mt.psgi"

    # same as httpd
    image: ${DOCKER_MT_IMAGE:-movabletype/dev:perl-5.20}
    restart: always
    entrypoint: "/usr/local/bin/docker-entrypoint.sh"
    volumes:
      - "./docker-entrypoint.sh:/usr/local/bin/docker-entrypoint.sh"
      - "${MT_HOME_PATH:-../../movabletype}:/var/www/cgi-bin/mt"
      - "${MT_CONFIG_CGI:-../mt-config.cgi-original}:/var/www/cgi-bin/mt/mt-config.cgi${NO_MT_CONFIG_CGI}"
      - "${BASE_SITE_PATH:-site}:/var/www/html"
      - "${MT_HOME_PATH:-../../movabletype}/mt-static:/var/www/html/mt-static"
      - "support:/var/www/cgi-bin/mt/mt-static/support"
      - "support:/var/www/html/mt-static/support"
