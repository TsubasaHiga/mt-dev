#!/bin/bash -xe
set -o pipefail

repo=$1
dir=$2
branch=$3

if [ ! -e $dir ]; then
    git clone $repo $dir
fi

cd $dir
git fetch --all --prune

if [ "$UPDATE_BRANCH" = "yes" -o "$UPDATE_BRANCH" = "1" ] && [ -n "$branch" ]; then
    git checkout .
    git clean -f
    git checkout $branch
    git rebase $(git rev-parse --abbrev-ref --symbolic-full-name @{u})
fi
